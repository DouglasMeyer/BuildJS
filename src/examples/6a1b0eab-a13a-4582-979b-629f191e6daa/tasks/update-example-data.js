#!/usr/bin/env node
var fs = require('fs');

fs.readdir('..', function(err, ids){
  if (err) {
    console.log('Error: ' + err);
    return;
  }

  var exampleDataService = '// NOTE: DO NOT EDIT: This file is generated by update-example-data.js\n';
  exampleDataService += "angular.module('BuildJS').service('ExampleData', function(){\n";
  exampleDataService += "  return ";
  var data = [], example;
  for (var i=0,id; id=ids[i]; i++){
    example = {
      id: id,
      package: JSON.parse(fs.readFileSync('../'+id+'/package.json')),
      terms: []
    };
    for (var dep in example.package.devDependencies){
      example.terms.push(dep);
    }
    data.push(example);
  }
  exampleDataService += JSON.stringify(data, null, '  ')+";\n";
  exampleDataService += "});";

  fs.writeFile('src/example-data.js', exampleDataService, function(err){
    if (err) {
      console.log('Error: ' + err);
      return;
    }

    console.log(exampleDataService);
  });
});
